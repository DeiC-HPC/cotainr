// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/universal
{
	"name": "Cotainr devcontainer",

	// Default image to use as a base for the dev container.
	// If you don't have access to this registry, you can build the container locally from the ./github/dockerfiles/Dockerfile.
	"image": "ghcr.io/deic-hpc/cotainr-dev_env-apptainer-1.3.4:docker_dev_env_PR_pipeline",

	// Set security options needed to run Apptainer/SingularityCE in the container.
	"securityOpt": ["systempaths=unconfined"],

	// Sync the uv python venv on startup
	// https://code.visualstudio.com/remote/advancedcontainers/start-processes
	"postStartCommand": "uv sync --frozen",

	// Set environment variables to use in IDE proceses in the container.
	"remoteEnv": {
		"UV_LINK_MODE": "copy"  // hardlinking does not seem to work properly in a volume mount
	},

	// Run container as non-root user. More info: https://aka.ms/dev-containers-non-root.
	// https://code.visualstudio.com/remote/advancedcontainers/add-nonroot-user#_specifying-a-user-for-vs-code
	"remoteUser": "1000:1000",

	// Configure tool-specific properties.
	"customizations": {
		// Define VS Code extensions to install in the dev container.
		// https://code.visualstudio.com/docs/devcontainers/containers#_managing-extensions
		"vscode": {
			"extensions": [
				"ms-python.python",
				"ms-azuretools.vscode-containers",
				"ms-vscode.makefile-tools",
				"github.vscode-github-actions",
				"streetsidesoftware.code-spell-checker",
				"tamasfe.even-better-toml",
				"redhat.vscode-yaml",
				"DavidAnson.vscode-markdownlint",
				"trond-snekvik.simple-rst"
			]
		}
	}
}
